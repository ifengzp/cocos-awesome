# æ•ˆæžœæ¼”ç¤º

é•œé¢ä¸Šæ‰«è¿‡ä¸€é“å…‰æ³½æ˜¯UIé‡Œé¢å¾ˆå¸¸ç”¨çš„ä¸€ç§ç‰¹æ•ˆï¼Œé€šå¸¸ç”¨æ¥å¼ºè°ƒæŸä¸ªç‰©ä½“æˆ–è€…å‡¸æ˜¾ç‰©ä½“çš„â€œç¨€æœ‰â€ä»·å€¼ï¼Œæ¯”å¦‚å¡ç‰‡ä¸­æ‰«è¿‡ä¸€é“å…‰èŠ’ç­‰

![demo](./resources/demo.gif)

# å®žçŽ°æ€è·¯

æ ¹æ®è¿™ä¸ªæ•ˆæžœçš„å®žé™…éœ€æ±‚ï¼Œå¯ä»¥æå–åˆ°ä¸¤ä¸ªå…³é”®ç‚¹ï¼Œä¸€ä¸ªæ˜¯å…‰è·¯çš„ç”Ÿæˆï¼Œä¸€ä¸ªæ˜¯å…‰è·¯éšç€æ—¶é—´è¿›è¡Œåç§»ã€‚ç›´è§‚å¯ä»¥çœ‹å‡ºå…‰è·¯ç”±ä¸¤æ ¹æ–œçŽ‡ä¸€æ ·çš„ç›´çº¿ç»„æˆï¼Œå…¶ä¸­ä¸€æ ¹åœ¨xè½´ä¸Šåç§»ä¸€å®šçš„è·ç¦»ï¼Œä¸¤æ ¹æ–œçº¿å°±èƒ½å¤Ÿç»„æˆä¸€ä¸ªå€¾æ–œçš„åŒºåŸŸï¼Œè¿™ä¸ªåŒºåŸŸç”¨æ•°å­¦æ¥è¡¨è¾¾å°±æ˜¯ï¼šä¸¤æ ¹æ–œçº¿å½¢æˆçš„ä¸ç­‰å¼ç»„ã€‚ç›´çº¿çš„æ–œæˆªå¼æ–¹ç¨‹æ˜¯`y = kx + b`ï¼Œå‡è®¾æ–œçŽ‡kä¸º1ï¼Œé‚£å…‰è·¯çš„åŒºåŸŸå°±å¯ä»¥è¡¨ç¤ºä¸ºï¼š`x >= -y` å’Œ `x <= -y + width`ï¼Œå…¶ä¸­`width`å°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„å…‰è·¯çš„å®½åº¦ï¼Œæœ‰äº†åŒºåŸŸä¹‹åŽæˆ‘ä»¬åªéœ€è¦è®©ç¬¦åˆè¯¥åŒºåŸŸçš„åƒç´ ç‚¹è‰²å½©å åŠ ç‚¹å˜åŒ–å°±å¯ä»¥å®žçŽ°å…‰è·¯çš„æ•ˆæžœã€‚

```c++
void main () {
  vec4 color = vec4(1, 1, 1, 1);
  color *= texture(texture, v_uv0);

  if (v_uv0.x >= -v_uv0.y && v_uv0.x <= -v_uv0.y + width) {
    color *= strength;
  }

  gl_FragColor = color;
}
```

å…‰è·¯éšç€æ—¶é—´çš„åç§»æ•ˆæžœï¼Œå…¶å®žå°±æ˜¯è®©å…‰è·¯çš„æ–œè·éšç€æ—¶é—´çš„å˜åŒ–å¢žåŠ å°±å¯ä»¥äº†ã€‚è¿™é‡Œå¯ä»¥é€šè¿‡è„šæœ¬çš„æ–¹å¼åœ¨æ¯å¸§çš„å›žè°ƒä¸­æŠŠåç§»çš„è·ç¦»åŠ¨æ€ä¼ è¿›æ¥ï¼Œä½†æ˜¯è¿™ç§ä¼ é€’å…¶å®žæŒºè€—æ€§èƒ½çš„ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼å°±æ˜¯æˆ‘ä»¬å¯ä»¥å¼•å…¥`cc-global`ï¼Œç„¶åŽé€šè¿‡`cc_time.x`æ‹¿åˆ°ç´¯ç§¯çš„æ—¶é—´å‚æ•°ï¼Œç„¶åŽåŠ ä¸Šæˆ‘ä»¬çš„åç§»é™åˆ¶æ¥å®žçŽ°å…‰è·¯çš„å¾ªçŽ¯æ’­æ”¾ã€‚å…¶ä¸­æˆ‘ä»¬å…‰è·¯çš„èµ·ç‚¹åº”è¯¥æ˜¯`0.0 - width`ï¼Œå…‰è·¯çš„åç§»é•¿åº¦åº”è¯¥æ˜¯`width + 1.0 + width`ï¼š

```c++
#include <cc-global>
void main () {
  vec4 color = vec4(1, 1, 1, 1);
  color *= texture(texture, v_uv0);

  float time_step = -width;
  time_step += mod(cc_time.x, 1.0 + 2.0 * width);

  if (v_uv0.x >= -v_uv0.y + time_step && v_uv0.x <= -v_uv0.y + width + time_step) {
    color *= strength;
  }

  gl_FragColor = color;
}

ä¸ºäº†è®©æ•ˆæžœå‘ˆçŽ°æ›´åŠ å®Œç¾Žï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åŽ»è°ƒæ•´ä¸€ä¸‹å…‰è·¯çš„æ–œçŽ‡ï¼Œå¦‚æžœéœ€è¦å¤šæ¡å…‰è·¯çš„è¯ï¼Œä¹Ÿå¯ä»¥å¤šå¤åˆ¶å‡ ä¸ªä¸ç­‰å¼ç»„åŠ ä¸Šä¸åŒçš„åç§»è·ç¦»å’Œå®½åº¦å°±å¯ä»¥äº†ã€‚å¦å¤–å¼•æ“Žæ˜¯é»˜è®¤å¯ç”¨äº†åŠ¨æ€åˆå›¾ï¼Œå®ƒä¼šè‡ªåŠ¨å°†åˆé€‚çš„è´´å›¾åŠ¨æ€åˆå¹¶åˆ°ä¸€å¼ å¤§å›¾ä¸Šæ¥å‡å°‘drawcallï¼Œè¿™æ ·å­å°±ä¼šå¯¼è‡´æˆ‘ä»¬åœ¨effectä¸­æ‹¿åˆ°çš„uvåæ ‡ä¸å‡†ç¡®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `cc.dynamicAtlasManager.enabled = false` æŠŠåˆå›¾ç»™å…³æŽ‰ï¼Œä½†æ˜¯è¿™æ˜¯ä¸ªå…¨å±€å¼€å…³ï¼Œæ‰€ä»¥æ›´å¥½çš„æ–¹æ³•æ˜¯åœ¨èµ„æºç®¡ç†é¢æ¿ä¸­æŠŠè¯¥èµ„æºçš„`packable`å‹¾é€‰æŽ‰ï¼Œè¿™æ ·å­å®ƒå°±ä¸ä¼šè¢«æ‰“åŒ…åˆ°åˆå›¾ä¸­äº†ã€‚

# æ•ˆæžœé¢„è§ˆ

**æºç **èŽ·å–è¯·ç‚¹å‡»**æŸ¥çœ‹åŽŸæ–‡**ï¼Œé•¿æŒ‰äºŒç»´ç **æŸ¥çœ‹æ•ˆæžœðŸ‘‡**

![ewm](./resources/ewm.png)

æˆ‘æ˜¯å¼‚åï¼Œä½ çš„é˜…è¯»æ˜¯æˆ‘çš„åŠ¨åŠ›




