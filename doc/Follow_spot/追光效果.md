# æ•ˆæœæ¼”ç¤º

è¿½å…‰æ•ˆæœæ˜¯åœ¨èˆå°å…¨åœºé»‘æš—çš„æƒ…å†µä¸‹ç”¨å…‰æŸ±çªå‡ºè§’è‰²æˆ–å…¶ä»–ç‰¹æ®Šç‰©ä½“ï¼Œé€šè¿‡äººä¸ºæ“æ§å…‰æºè·Ÿéšäººç‰©ç§»åŠ¨ï¼Œä¸»è¦ç”¨æ¥çªå‡ºè§’è‰²ä¸»ä½“ä»¥åŠä¸»ä½“å’Œç¯å¢ƒçš„å…³ç³»ã€‚åœ¨æ¸¸æˆä¸­å¯ä»¥ç”¨æ¥çªå‡ºæ°›å›´ä»¥åŠèšç„¦ç©å®¶è§†çº¿ç„¦ç‚¹ï¼Œä¸ä»…å¯ä»¥ç”¨æ¥è¥é€ æ²‰æµ¸å¼æ°›å›´ï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨è§£è°œæˆ–è€…æ‰¾ç‰©å“ç­‰ç±»åˆ«çš„æ¸¸æˆä¸­ã€‚

![demo](http://cdn.blog.ifengzp.com/cocos-awesome/Follow_spot/resources/demo.gif)

# å®ç°æ€è·¯

æ ¹æ®å®é™…æ•ˆæœå¯ä»¥æç‚¼å‡º3ä¸ªåŠŸèƒ½ç‚¹ï¼šå…‰åœˆçš„å½¢çŠ¶å’Œå¤§å°å¯æ§ï¼Œå…‰åœˆçš„è¾¹ç¼˜è™šåŒ–ï¼Œå…‰åœˆå¯æ“æ§ç§»åŠ¨ã€‚

å…‰åœˆæ˜¯ä¸€ä¸ªåœ†ï¼Œå‡è®¾åœ†å¿ƒåœ¨çº¹ç†çš„ä¸­é—´ï¼Œå®ƒçš„åæ ‡æ˜¯`vec2(0.5,0.5)`ï¼Œæˆ‘ä»¬åªéœ€è®©åˆ°åœ†å¿ƒçš„è·ç¦»å¤§äºåŠå¾„çš„åƒç´ ä¸¢å¼ƒæˆ–è€…é€æ˜åº¦ä¸º0ï¼Œä»£ç å¦‚ä¸‹ï¼š

```c++
void main () {
  vec4 color = vec4(1, 1, 1, 1);
  color *= texture(texture, v_uv0);
  color *= v_color;

  color.a = step(length(v_uv0 - vec2(0.5,0.5)), 0.1);
  gl_FragColor = color;
}
```

![ellipse](http://cdn.blog.ifengzp.com/cocos-awesome/Follow_spot/resources/ellipse.png)

å…¶ä¸­`step` æ˜¯å†…ç½®çš„è§„æ•´å‡½æ•° `step(a, x) = x >= a? 1 : 0`ï¼Œ`length`æ˜¯å–æ¨¡ã€‚ä¸Šé¢çš„ä»£ç æ®µåº”ç”¨åœ¨å¯ä»¥åœ¨æ­£æ–¹å½¢çš„çº¹ç†ä¸­å¯ä»¥å¾—å‡ºä¸€ä¸ªæ­£åœ†ï¼Œä½†æ˜¯å¦‚æœçº¹ç†ä¸æ˜¯æ­£æ–¹å½¢ï¼Œä¸Šé¢å‡ºæ¥çš„æ•ˆæœä¼šæ˜¯ä¸€ä¸ªæ¤­åœ†ï¼Œå› ä¸ºåœ¨shaderæ— è®ºçº¹ç†çš„çœŸå®å®½é«˜æ˜¯å¤šå°‘ï¼Œå®ƒçš„`x,y`å˜åŒ–èŒƒå›´éƒ½æ˜¯0~1ï¼Œæ˜¯æ¯”ä¾‹çš„å˜åŒ–ã€‚å¦‚æœéœ€è¦äº§ç”Ÿä¸€ä¸ªæ­£åœ†ï¼Œè¿˜æ˜¯å¾—é€šè¿‡è·å–çº¹ç†çš„çœŸå®å®½é«˜ï¼Œæ¥è®¡ç®—çœŸå®çš„å®½é«˜æ¯”ä¾‹ï¼Œå¼‚åé€‰æ‹©çš„æ–¹å¼æ˜¯åœ¨åœ¨ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™ï¼Œè¾“å…¥ä¸€ä¸ª`wh_ratio`æ¯”ä¾‹æ¥è·å–ï¼Œåœ†çš„çœŸå®åŠå¾„é€šè¿‡å‹¾è‚¡å®šç†æ¥è®¡ç®—ï¼Œå¼‚åè¿™é‡Œå°±æ²¡æœ‰å¼€æ–¹äº†ï¼Œç›´æ¥é€šè¿‡åŠå¾„å¹³æ–¹çš„æ¯”è¾ƒæ¥èˆå»åœ†å¤–çš„ç‚¹ã€‚

```c++
void main () {
  vec4 o = vec4(1, 1, 1, 1);
  o *= texture(texture, v_uv0);
  o *= v_color;

  float circle = radius * radius;
  float rx = center.x * wh_ratio;
  float ry = center.y;
  float dis = (v_uv0.x * wh_ratio - rx) * (v_uv0.x * wh_ratio - rx) + (v_uv0.y  - ry) * (v_uv0.y - ry);

  o.a = step(dis, 0.1);
  gl_FragColor = o;
}
```

```js
onload() {
  this.material.setProperty('wh_ratio', this.bg.width / this.bg.height);
}
```

è¿™æ ·å­å°±èƒ½åœ¨ä¸€ä¸ªä¸åŒå®½é«˜æ¯”çš„çº¹ç†ä¸­éƒ½èƒ½å¤Ÿç”»å‡ºä¸€ä¸ªæ­£åœ†ã€‚

![circle](http://cdn.blog.ifengzp.com/cocos-awesome/Follow_spot/resources/circle.png)

è¿™æ ·çš„åœ†çš„è¾¹ç¼˜æ˜¯æœ‰é”¯é½¿çš„ï¼Œè€Œä¸”è¿½å…‰éœ€è¦å…‰åœˆçš„è¾¹ç¼˜è™šåŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å€ŸåŠ©å¦å¤–ä¸€ä¸ªå†…ç½®æ’å€¼å‡½æ•°`smoothstep(min, max, x)`ï¼Œå®ƒèƒ½å¤Ÿè¿”å›ä¸€ä¸ªåœ¨è¾“å…¥å€¼ä¹‹é—´å¹³ç¨³å˜åŒ–çš„æ’å€¼ï¼Œä»¥æ­¤æ¥è¾¾åˆ°è¾¹ç¼˜ç¾½åŒ–çš„æ•ˆæœã€‚

```c++
void main () {
  vec4 o = vec4(1, 1, 1, 1);
  o *= texture(texture, v_uv0);
  o *= v_color;

  float circle = radius * radius;
  float rx = center.x * wh_ratio;
  float ry = center.y;
  float dis = (v_uv0.x * wh_ratio - rx) * (v_uv0.x * wh_ratio - rx) + (v_uv0.y  - ry) * (v_uv0.y - ry);

  o.a = smoothstep(circle, circle - blur, dis);
  gl_FragColor = o;
}
```

![circle](http://cdn.blog.ifengzp.com/cocos-awesome/Follow_spot/resources/feather.png)

æ¥ä¸‹æ¥çš„è®©å…‰åœˆéšç€åŠ¨ä½œçš„ç§»åŠ¨å°±å¾ˆç®€å•äº†ï¼Œåœ¨`touch`çš„æ—¶å€™å»æ›´æ”¹å…‰åœˆçš„åœ†å¿ƒä½ç½®å°±è¡Œï¼Œå› ä¸ºæˆ‘ä»¬çš„shaderä¸­æ˜¯æ¯”ä¾‹çš„å˜åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ è¿›å»çš„æ—¶å€™ä¹Ÿè¦è½¬åŒ–æˆæ¯”ä¾‹ï¼ŒåŒæ—¶åˆ«å¿˜äº†åæ ‡çš„è½¬åŒ–ï¼š

```js
touchEvent(evt: cc.Event.EventTouch) {
  let pos = evt.getLocation();
  this.material.setProperty('center', [pos.x / this.bg.width, (this.bg.height - pos.y) / this.bg.height]);
}
```

è¿™æ ·å­æˆ‘ä»¬å°±æŠŠè¿½å…‰çš„åŠŸèƒ½å®ç°äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯æ ¹æ®ä¸šåŠ¡çš„éœ€è¦ï¼Œç”Ÿæˆè¿½å…‰çš„è·¯å¾„ï¼Œè¿™ä¸ªå°±æ˜¯æŠŠåœ†å¿ƒçš„ä½ç½®ä¼ è¿›æ¥å³å¯ã€‚é™¤äº†åº”ç”¨åˆ°èˆå°è¿½å…‰çš„é‚£ç§åœºæ™¯ä¸­ï¼Œå¼‚åè§‰å¾—å®ƒçš„åº”ç”¨è¿˜å¯ä»¥æœ‰æ›´å¤šçš„æƒ³è±¡ç©ºé—´ï¼Œæ¯”å¦‚åœ¨é»‘æš—çš„åšç‰©é¦†é‡Œï¼Œåœ¨æ‰‹ç”µç­’çš„ç¯å…‰ç…§å°„ä¸‹ï¼Œè’™å¨œä¸½èçš„å¾®ç¬‘å°±æ›´åŠ ç¥ç§˜äº†....

![mystical](http://cdn.blog.ifengzp.com/cocos-awesome/Follow_spot/resources/mystical.gif)

## æ•ˆæœé¢„è§ˆ

æºç è·å–è¯·ç‚¹å‡»**æŸ¥çœ‹åŸæ–‡**ï¼Œé•¿æŒ‰äºŒç»´ç æŸ¥çœ‹æ•ˆæœğŸ‘‡

![ewm](http://cdn.blog.ifengzp.com/cocos-awesome/Follow_spot/resources/preview_ewm.png)




