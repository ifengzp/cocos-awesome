# æ•ˆæœæ¼”ç¤º

ç›¸å†Œæ˜¯ä¸€ä¸ªå¤§å®¶æ¯”è¾ƒç†Ÿæ‚‰çš„åœºæ™¯ï¼Œä¸€èˆ¬æˆ‘ä»¬æ˜¯å®ç°çš„éƒ½æ˜¯é‚£ç§è·‘é©¬ç¯å¼çš„è½®æ’­ç›¸å†Œï¼Œè¿™é‡Œå¼‚åç»™å¤§å®¶æä¾›ä¸€ä¸ªåˆ©ç”¨shaderå®ç°å›¾ç‰‡æ¸å˜è¿‡æ¸¡çš„ç›¸å†Œæ€è·¯


![demo](http://cdn.blog.ifengzp.com/cocos-awesome/Photo_gallery/resources/demo.gif)

# å®ç°æ€è·¯

æ‹†åˆ†ä¸€ä¸‹åŠŸèƒ½ç‚¹ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªï¼šä¸€ä¸ªæ˜¯å®ç°å›¾ç‰‡çš„æ¸å˜ï¼Œä¸€ä¸ªæ˜¯å®ç°å›¾ç‰‡çš„åˆ‡æ¢ã€‚

å›¾ç‰‡çš„æ¸å˜å¯ä»¥ç†è§£ä¸ºéšç€æ—¶é—´çš„å˜åŒ–ï¼Œåœ¨æŸä¸€æ–¹å‘ä¸Šçš„å±€éƒ¨çš„åƒç´ ç‚¹çš„é€æ˜åº¦å˜åŒ–ã€‚demoä¸­å®ç°çš„æ•ˆæœæ˜¯ä¸€ä¸ªæ°´å¹³æ»šè½´å¼çš„åˆ‡æ¢ï¼Œæ°´å¹³å¹³ç§»åœ¨æ•°å­¦ä¸Šçš„å®ç°å…¶å®å°±æ˜¯ä¸€ä¸ªç®€å•çš„å…³äºæ—¶é—´å˜åŒ–çš„å‚ç›´ç›´çº¿`x = time`ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠæ¯ä¸ªåƒç´ ç‚¹çš„xåæ ‡å’Œè¿™ä¸ªå‚ç›´ç›´çº¿åšæ¯”è¾ƒï¼Œåœ¨å·¦è¾¹çš„é€æ˜åº¦è®¾ä¸º0ï¼Œåœ¨å³è¾¹çš„é€æ˜åº¦è®¾ä¸º1ï¼Œç„¶åå†é€šè¿‡å¹³æ»‘å–æ ·å°±èƒ½å¤Ÿæœ‰æ¸å˜è¿‡æ¸¡çš„æ•ˆæœï¼š

```c++
void main () {
  vec4 color = vec4(1, 1, 1, 1);
  color *= texture(texture, v_uv0);
  color *= v_color;

  #if USE_TRAMSFORM
    color.a = smoothstep(0.0, u_fade_radius, u_fade_radius + v_uv0.x - u_time);
  #endif

  gl_FragColor = color;
}
```

å®ç°äº†å›¾ç‰‡çš„æ¸å˜ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å›¾ç‰‡çš„åˆ‡æ¢ï¼Œæ‰€æœ‰çš„å›¾ç‰‡å…¶å®éƒ½åœ¨ä¸€ä¸ªé˜Ÿåˆ—å½“ä¸­ï¼Œæˆ‘ä»¬åœ¨æ¸å˜å®Œæˆä¹‹ååªéœ€è¦æŠŠæœ€ä¸Šé¢çš„çš„é‚£å¼ å›¾ç‰‡æ”¾åˆ°æœ€ä¸‹é¢ï¼Œå°±èƒ½å¤Ÿè®©è¿™ä¸ªç›¸å†Œä¸€ç›´åœ¨å¾ªç¯æ’­æ”¾ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬å†åŠ ä¸Šä¸€äº›å›¾ç‰‡çš„çŠ¶æ€å¤„ç†å°±èƒ½å¤Ÿæ˜¯å®ç°demoä¸­çš„æ¸å˜ç›¸å†Œæ•ˆæœäº†

```js
isTransforming: boolean = false;
bgTramsform() {
  if (this.isTransforming) return;
  this.isTransforming = true;

  let time = 0.0;
  let node = this.switchNodeList[0];
  let material = node.getComponent(cc.Sprite).getMaterial(0);
  material.setProperty('u_fade_radius', this.fadeRadius);
  material.setProperty('u_time', time);
  material.define('USE_TRAMSFORM', true, 0, true);

  let timer = setInterval(() => {
    time += 0.03;
    material.setProperty('u_time', time);
    if (time > 1.0 + this.fadeRadius) {
      this.switchNodeList.shift();
      this.switchNodeList.push(node);
      this.switchNodeList.forEach((node, idx) => node.zIndex = this.switchNodeList.length - idx)
      material.define('USE_TRAMSFORM', false, 0, true);
      this.isTransforming = false;
      timer && clearInterval(timer);
    }
  }, 30);
}
```

![demo](http://cdn.blog.ifengzp.com/cocos-awesome/Photo_gallery/resources/demo.gif)

## æ•ˆæœé¢„è§ˆ

æºç è·å–è¯·ç‚¹å‡»**æŸ¥çœ‹åŸæ–‡**ï¼Œé•¿æŒ‰äºŒç»´ç æŸ¥çœ‹æ•ˆæœğŸ‘‡

![ewm](http://cdn.blog.ifengzp.com/cocos-awesome/Photo_gallery/resources/preview_ewm.png)
